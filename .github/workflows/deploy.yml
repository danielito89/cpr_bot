name: Desplegar en Lightsail

# Esto se dispara cada vez que haces 'push' a la rama 'main'
on:
  push:
    branches:
      - main  # üëà Cambia esto si tu rama principal es 'master' u otra

jobs:
  deploy:
    # Usamos la √∫ltima versi√≥n de Ubuntu para ejecutar esto
    runs-on: ubuntu-latest

    steps:
    - name: üöö Desplegando cambios en el servidor
      # Usamos una "Action" popular que simplifica la conexi√≥n SSH
      uses: appleboy/ssh-action@v1.0.3
      with:
        # Lee los secretos que configuraste en el Paso 3
        host: ${{ secrets.LIGHTSAIL_HOST }}
        username: ${{ secrets.LIGHTSAIL_USER }}
        key: ${{ secrets.LIGHTSAIL_SSH_PRIVATE_KEY }}
        port: 22 # Opcional, c√°mbialo si usas un puerto SSH diferente

        # ‚ö†Ô∏è ¬°IMPORTANTE! Edita los comandos de aqu√≠ abajo
        script: |
          # 1. Ve a la carpeta de tu proyecto en el servidor
          cd /home/ubuntu/cpr_bot  # üëà ¬°Cambia esta ruta!

          # 2. Descarga los √∫ltimos cambios de la rama 'main'
          git pull origin main

          # 3. (Opcional) Ejecuta otros comandos
          # Ejemplo si usas Node.js:
          # npm install
          # pm2 restart mi-app

          # Ejemplo si usas Python con un venv:
          # source /ruta/a/mi/venv/bin/activate
          # pip install -r requirements.txt
          # sudo systemctl restart gunicorn

          # 4. Confirma que termin√≥
          echo "‚úÖ Despliegue completado"
